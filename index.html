<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Task Management App</title>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel compiler (so JSX works in browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase (v9 modular APIs) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>


  <style>
    body {
      margin: 0;
      font-family: Inter, sans-serif;
      background: #f9fafb;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    /* === HOOKS === */
    const { useState, useEffect, useRef } = React;

    /* === FIREBASE IMPORTS VIA CDN === */
    const { initializeApp } = firebase;
    const { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = firebase.auth;
    const { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, runTransaction } = firebase.firestore;

    /* =======================================================
       === YOUR TASK MANAGEMENT APP CODE STARTS BELOW ===
       (taken from your uploaded file, imports removed)
    ======================================================= */

    // Helper function to format date/time
    const formatDate = (date) => {
      const d = new Date(date);
      const formattedDate = d.toLocaleDateString('en-GB');
      const formattedTime = d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      return `${formattedDate}, ${formattedTime}`;
    };

    // Helper function to calculate days
    const getDaysDiff = (startDate, endDate) => {
      if (!startDate || !endDate) return null;
      const start = new Date(startDate);
      const end = new Date(endDate);
      const diffTime = Math.abs(end - start);
      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    };

    /* ======================
       App Component
    ====================== */
    function App() {
      const [db, setDb] = useState(null);
      const [auth, setAuth] = useState(null);
      const [userId, setUserId] = useState(null);
      const [isAuthReady, setIsAuthReady] = useState(false);
      const [currentPage, setCurrentPage] = useState('dashboard');
      const [firms, setFirms] = useState([]);
      const [employees, setEmployees] = useState([]);
      const [tasks, setTasks] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [message, setMessage] = useState('');

      // Firebase initialization and auth
      useEffect(() => {
        const initializeFirebase = async () => {
          try {
            // ⚠️ Replace this with your real firebaseConfig!
            const firebaseConfig = {
              apiKey: "YOUR_API_KEY",
              authDomain: "YOUR_PROJECT.firebaseapp.com",
              projectId: "YOUR_PROJECT_ID",
              storageBucket: "YOUR_PROJECT.appspot.com",
              messagingSenderId: "YOUR_SENDER_ID",
              appId: "YOUR_APP_ID"
            };

            const app = initializeApp(firebaseConfig);
            const firestore = getFirestore(app);
            const authInstance = getAuth(app);

            setDb(firestore);
            setAuth(authInstance);

            // Anonymous sign-in for demo
            await signInAnonymously(authInstance);

            onAuthStateChanged(authInstance, (user) => {
              if (user) {
                setUserId(user.uid);
                setIsAuthReady(true);
              } else {
                setUserId(null);
                setIsAuthReady(true);
              }
            });

          } catch (error) {
            console.error("Error initializing Firebase:", error);
            setMessage("Error initializing app. Check console for details.");
          }
        };
        initializeFirebase();
      }, []);

      // Fetch Firestore data
      useEffect(() => {
        if (!db || !isAuthReady) return;
        const appId = "default-app-id";

        const firmsRef = collection(db, `artifacts/${appId}/public/data/firms`);
        const employeesRef = collection(db, `artifacts/${appId}/public/data/employees`);
        const tasksRef = collection(db, `artifacts/${appId}/public/data/tasks`);

        const firmUnsub = onSnapshot(firmsRef, (snapshot) => {
          setFirms(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
        });

        const empUnsub = onSnapshot(employeesRef, (snapshot) => {
          setEmployees(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
        });

        const taskUnsub = onSnapshot(tasksRef, (snapshot) => {
          setTasks(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
          setIsLoading(false);
        });

        return () => {
          firmUnsub();
          empUnsub();
          taskUnsub();
        };
      }, [db, isAuthReady]);

      // Page routing
      const renderPage = () => {
        switch (currentPage) {
          case 'dashboard': return <Dashboard firms={firms} employees={employees} tasks={tasks} />;
          case 'database': return <Database firms={firms} employees={employees} tasks={tasks} />;
          default: return <Dashboard firms={firms} employees={employees} tasks={tasks} />;
        }
      };

      if (isLoading) {
        return <div style={{ padding: 20 }}>Loading...</div>;
      }

      return (
        <div style={{ padding: "20px" }}>
          <h1>Task Management App</h1>
          <nav>
            <button onClick={() => setCurrentPage('dashboard')}>Dashboard</button>
            <button onClick={() => setCurrentPage('database')}>Database</button>
          </nav>
          {message && <p style={{ color: "red" }}>{message}</p>}
          {renderPage()}
          <footer style={{ marginTop: 20, fontSize: "12px" }}>
            <p>User ID: {userId}</p>
          </footer>
        </div>
      );
    }

    /* === Dashboard Component === */
    function Dashboard({ firms, employees, tasks }) {
      return (
        <div>
          <h2>Dashboard</h2>
          <p>Total Firms: {firms.length}</p>
          <p>Total Employees: {employees.length}</p>
          <p>Total Tasks: {tasks.length}</p>
        </div>
      );
    }

    /* === Database Component === */
    function Database({ firms, employees, tasks }) {
      return (
        <div>
          <h2>Database (Tasks)</h2>
          <table border="1" cellPadding="5">
            <thead>
              <tr>
                <th>Firm</th>
                <th>Assigned To</th>
                <th>Status</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              {tasks.map((t) => (
                <tr key={t.id}>
                  <td>{t.firm}</td>
                  <td>{t.assignedTo}</td>
                  <td>{t.status}</td>
                  <td>{t.description}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    /* =======================================================
       === END OF APP CODE ===
    ======================================================= */

    // Render App
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>

